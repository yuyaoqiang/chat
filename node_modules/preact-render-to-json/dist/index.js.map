{"version":3,"file":null,"sources":["../src/util.js","../src/index.js"],"sourcesContent":["\nexport let falsey = v => v==null || v===false;\n\nexport function assign(obj, props) {\n\tfor (let i in props) obj[i] = props[i];\n\treturn obj;\n}\n\nexport function getNodeProps(vnode) {\n\tlet defaultProps = vnode.nodeName.defaultProps,\n\t\tprops = assign({}, defaultProps || vnode.attributes);\n\tif (defaultProps) assign(props, vnode.attributes);\n\tif (vnode.children) props.children = vnode.children;\n\treturn props;\n}\n\nexport const omit = (object, paths) =>\n\tObject.keys(object)\n\t\t.reduce((result, key) => {\n\t\t\tif (!paths.includes(key)) {\n\t\t\t\tresult[key] = object[key]; // eslint-disable-line no-param-reassign\n\t\t\t}\n\n\t\t\treturn result;\n\t\t}, {});\n","import { falsey, assign, getNodeProps, omit } from './util';\n\nconst SHALLOW = { shallow: true };\n\n// components without names, kept as a hash for later comparison to return consistent UnnamedComponentXX names.\nconst UNNAMED = [];\n\nconst EMPTY = {};\n\n\n/** Render Preact JSX + Components to an HTML string.\n *\t@name render\n *\t@function\n *\t@param {VNode} vnode\tJSX VNode to render.\n *\t@param {Object} [context={}]\tOptionally pass an initial context object through the render path.\n *\t@param {Object} [options={}]\tRendering options\n *\t@param {Boolean} [options.shallow=false]\tIf `true`, renders nested Components as HTML elements (`<Foo a=\"b\" />`).\n */\nrenderToJSON.render = renderToJSON;\n\n\n/** Only render elements, leaving Components inline as `<ComponentName ... />`.\n *\tThis method is just a convenience alias for `render(vnode, context, { shallow:true })`\n *\t@name shallow\n *\t@function\n *\t@param {VNode} vnode\tJSX VNode to render.\n *\t@param {Object} [context={}]\tOptionally pass an initial context object through the render path.\n */\nlet shallowRender = (vnode, context) => renderToJSON(vnode, context, SHALLOW);\n\n\n/** The default export is an alias of `render()`. */\nexport default function renderToJSON(vnode, context, opts, inner) {\n\tlet { nodeName, attributes, children } = vnode || EMPTY,\n\t\tisComponent = false;\n\tcontext = context || {};\n\topts = opts || {};\n\n\tif (vnode==null || vnode===false) {\n\t\treturn null;\n\t}\n\n\t// #text nodes\n\tif (!nodeName) {\n\t\treturn vnode;\n\t}\n\n\t// components\n\tif (typeof nodeName==='function') {\n\t\tisComponent = true;\n\t\tif (opts.shallow && (inner || opts.renderRootComponent===false)) {\n\t\t\tnodeName = getComponentName(nodeName);\n\t\t}\n\t\telse {\n\t\t\tlet props = getNodeProps(vnode),\n\t\t\t\trendered;\n\n\t\t\tif (!nodeName.prototype || typeof nodeName.prototype.render!=='function') {\n\t\t\t\t// stateless functional components\n\t\t\t\trendered = nodeName(props, context);\n\t\t\t}\n\t\t\telse {\n\t\t\t\t// class-based components\n\t\t\t\tlet c = new nodeName(props, context);\n\t\t\t\t// turn off stateful re-rendering:\n\t\t\t\tc._disable = c.__x = true;\n\t\t\t\tc.props = props;\n\t\t\t\tc.context = context;\n\t\t\t\tif (c.componentWillMount) c.componentWillMount();\n\t\t\t\trendered = c.render(c.props, c.state, c.context);\n\n\t\t\t\tif (c.getChildContext) {\n\t\t\t\t\tcontext = assign(assign({}, context), c.getChildContext());\n\t\t\t\t}\n\t\t\t}\n\n\t\t\treturn renderToJSON(rendered, context, opts, opts.shallowHighOrder!==false);\n\t\t}\n\t}\n\n\tlet pieces = [];\n\tlet len = children && children.length;\n\tfor (let i=0; i<len; i++) {\n\t\tlet child = children[i];\n\t\tif (!falsey(child)) {\n\t\t\tlet ret = renderToJSON(child, context, opts, true);\n\t\t\tif (ret) pieces.push(ret);\n\t\t}\n\t}\n\n\tlet ret = {\n\t\t$$typeof: Symbol.for('react.test.json'),\n\t\ttype: nodeName\n\t};\n\n\tif (attributes) {\n\t\tret.props = omit(attributes, ['key', 'children', 'className']);\n\n\t\tif (attributes.className && !attributes.class) {\n\t\t\tret.props.class = attributes.className;\n\t\t}\n\t}\n\n\tif (attributes && attributes.key) {\n\t\tret.key = attributes.key;\n\t}\n\n\tif (pieces.length) {\n\t\tret.children = pieces;\n\t}\n\n\treturn ret;\n}\n\nfunction getComponentName(component) {\n\tlet proto = component.prototype,\n\t\tctor = proto && proto.constructor;\n\treturn component.displayName || component.name || (proto && (proto.displayName || proto.name)) || getFallbackComponentName(component);\n}\n\nfunction getFallbackComponentName(component) {\n\tlet str = Function.prototype.toString.call(component),\n\t\tname = (str.match(/^\\s*function\\s+([^\\( ]+)/) || EMPTY)[1];\n\tif (!name) {\n\t\t// search for an existing indexed name for the given component:\n\t\tlet index = -1;\n\t\tfor (let i=UNNAMED.length; i--; ) {\n\t\t\tif (UNNAMED[i]===component) {\n\t\t\t\tindex = i;\n\t\t\t\tbreak;\n\t\t\t}\n\t\t}\n\t\t// not found, create a new indexed name:\n\t\tif (index<0) {\n\t\t\tindex = UNNAMED.push(component) - 1;\n\t\t}\n\t\tname = `UnnamedComponent${index}`;\n\t}\n\treturn name;\n}\nrenderToJSON.shallowRender = shallowRender;\n\n\nexport {\n\trenderToJSON as render,\n\trenderToJSON,\n\tshallowRender\n};\n"],"names":["falsey","v","assign","obj","props","i","getNodeProps","vnode","defaultProps","nodeName","attributes","children","omit","object","paths","Object","keys","reduce","result","key","includes","SHALLOW","shallow","UNNAMED","EMPTY","renderToJSON","render","shallowRender","context","opts","inner","isComponent","renderRootComponent","getComponentName","rendered","prototype","c","_disable","__x","componentWillMount","state","getChildContext","shallowHighOrder","pieces","len","length","child","ret","push","Symbol","for","className","class","component","proto","ctor","constructor","displayName","name","getFallbackComponentName","str","Function","toString","call","match","index"],"mappings":"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"}