{"ast":null,"code":"import \"antd-mobile/lib/toast/style/css\";\nimport _Toast from \"antd-mobile/lib/toast\";\nimport axios from 'axios';\nconst baseURL = process.env.NODE_ENV === 'production' ? 'api/' : '';\nconst timeout = 12000;\nconst reqeust = axios.create({\n  timeout,\n  transformRequest: [data => {\n    data = JSON.stringify(data);\n    return data;\n  }],\n  transformResponse: [data => {\n    if (typeof data === 'string' && data.startsWith('{')) {\n      data = JSON.parse(data);\n    }\n\n    return data;\n  }]\n}); // 请求拦截器\n\nreqeust.interceptors.request.use(config => {\n  config.url = `${baseURL}${config.url}`;\n  return config;\n}, error => {\n  error.msg = '服务器异常，请联系管理员！';\n  return Promise.resolve(error);\n});\n/**\n *响应拦截器\n* 自定义状态处理\n*/\n\nreqeust.interceptors.response.use(response => {\n  const {\n    data\n  } = response;\n\n  if (data.code !== 200) {\n    const hasError = errorHandle(data);\n    if (hasError) return Promise.reject(data);\n  }\n\n  return data;\n}, error => {\n  error.response.data = {};\n  error.response.msg = \"请求超时或服务器异常，请检查网络或联系管理员！\";\n  return Promise.reject(error.response);\n});\n\nconst errorHandle = data => {\n  if (data.code === 201) {\n    sessionStorage.clear();\n    window.location.replace(\"/login\");\n\n    _Toast.fail(data.msg);\n\n    return true;\n  }\n\n  if (data.code !== 200) {\n    _Toast.fail(data.msg);\n\n    return true;\n  }\n};\n\nexport default reqeust;","map":{"version":3,"sources":["/Users/yuanfang/Downloads/Telegram Desktop/封存/advisory-h5/src/request/request.ts"],"names":["axios","baseURL","process","env","NODE_ENV","timeout","reqeust","create","transformRequest","data","JSON","stringify","transformResponse","startsWith","parse","interceptors","request","use","config","url","error","msg","Promise","resolve","response","code","hasError","errorHandle","reject","sessionStorage","clear","window","location","replace","fail"],"mappings":";;AAAA,OAAOA,KAAP,MAAkB,OAAlB;AAGA,MAAMC,OAAe,GAAGC,OAAO,CAACC,GAAR,CAAYC,QAAZ,KAAyB,YAAzB,GAAwC,MAAxC,GAAiD,EAAzE;AACA,MAAMC,OAAe,GAAG,KAAxB;AAEA,MAAMC,OAAO,GAAGN,KAAK,CAACO,MAAN,CAAa;AAC5BF,EAAAA,OAD4B;AAE5BG,EAAAA,gBAAgB,EAAE,CAAEC,IAAD,IAAU;AAC5BA,IAAAA,IAAI,GAAGC,IAAI,CAACC,SAAL,CAAeF,IAAf,CAAP;AACA,WAAOA,IAAP;AACA,GAHiB,CAFU;AAM5BG,EAAAA,iBAAiB,EAAE,CAAEH,IAAD,IAAU;AAC7B,QAAI,OAAOA,IAAP,KAAgB,QAAhB,IAA4BA,IAAI,CAACI,UAAL,CAAgB,GAAhB,CAAhC,EAAsD;AACrDJ,MAAAA,IAAI,GAAGC,IAAI,CAACI,KAAL,CAAWL,IAAX,CAAP;AACA;;AACD,WAAOA,IAAP;AACA,GALkB;AANS,CAAb,CAAhB,C,CAcA;;AACAH,OAAO,CAACS,YAAR,CAAqBC,OAArB,CAA6BC,GAA7B,CAAkCC,MAAD,IAAY;AAC5CA,EAAAA,MAAM,CAACC,GAAP,GAAc,GAAElB,OAAQ,GAAEiB,MAAM,CAACC,GAAI,EAArC;AACA,SAAOD,MAAP;AACA,CAHD,EAGIE,KAAD,IAAW;AACbA,EAAAA,KAAK,CAACC,GAAN,GAAY,eAAZ;AACA,SAAOC,OAAO,CAACC,OAAR,CAAgBH,KAAhB,CAAP;AACA,CAND;AAQA;AACA;AACA;AACA;;AACAd,OAAO,CAACS,YAAR,CAAqBS,QAArB,CAA8BP,GAA9B,CAAmCO,QAAD,IAAwB;AACzD,QAAM;AAAEf,IAAAA;AAAF,MAAWe,QAAjB;;AACA,MAAIf,IAAI,CAACgB,IAAL,KAAc,GAAlB,EAAuB;AACtB,UAAMC,QAAQ,GAAGC,WAAW,CAAClB,IAAD,CAA5B;AACA,QAAIiB,QAAJ,EAAe,OAAOJ,OAAO,CAACM,MAAR,CAAenB,IAAf,CAAP;AACf;;AACD,SAAOA,IAAP;AACA,CAPD,EAOIW,KAAD,IAAW;AACbA,EAAAA,KAAK,CAACI,QAAN,CAAef,IAAf,GAAsB,EAAtB;AACAW,EAAAA,KAAK,CAACI,QAAN,CAAeH,GAAf,GAAqB,yBAArB;AACA,SAAOC,OAAO,CAACM,MAAR,CAAeR,KAAK,CAACI,QAArB,CAAP;AACA,CAXD;;AAaA,MAAMG,WAAW,GAAIlB,IAAD,IAAe;AAClC,MAAIA,IAAI,CAACgB,IAAL,KAAc,GAAlB,EAAuB;AACtBI,IAAAA,cAAc,CAACC,KAAf;AACAC,IAAAA,MAAM,CAACC,QAAP,CAAgBC,OAAhB,CAAwB,QAAxB;;AACA,WAAMC,IAAN,CAAWzB,IAAI,CAACY,GAAhB;;AACA,WAAO,IAAP;AACA;;AACD,MAAIZ,IAAI,CAACgB,IAAL,KAAc,GAAlB,EAAuB;AACtB,WAAMS,IAAN,CAAWzB,IAAI,CAACY,GAAhB;;AACA,WAAO,IAAP;AACA;AACD,CAXD;;AAYA,eAAef,OAAf","sourcesContent":["import axios from 'axios'\nimport { Toast } from 'antd-mobile';\nimport { Response } from './entity.d';\nconst baseURL: string = process.env.NODE_ENV === 'production' ? 'api/' : '';\nconst timeout: number = 12000;\n\nconst reqeust = axios.create({\n timeout,\n transformRequest: [(data) => {\n  data = JSON.stringify(data)\n  return data\n }],\n transformResponse: [(data) => {\n  if (typeof data === 'string' && data.startsWith('{')) {\n   data = JSON.parse(data)\n  }\n  return data\n }]\n});\n\n// 请求拦截器\nreqeust.interceptors.request.use((config) => {\n config.url = `${baseURL}${config.url}`\n return config\n}, (error) => {\n error.msg = '服务器异常，请联系管理员！'\n return Promise.resolve(error)\n})\n\n/**\n *响应拦截器\n* 自定义状态处理\n*/\nreqeust.interceptors.response.use((response: Response) => {\n const { data } = response\n if (data.code !== 200) {\n  const hasError = errorHandle(data)\n  if (hasError)  return Promise.reject(data)\n }\n return data;\n}, (error) => {\n error.response.data = {}\n error.response.msg = \"请求超时或服务器异常，请检查网络或联系管理员！\"\n return Promise.reject(error.response)\n})\n\nconst errorHandle = (data: any) => {\n if (data.code === 201) {\n  sessionStorage.clear()\n  window.location.replace(\"/login\");\n  Toast.fail(data.msg)\n  return true;\n }\n if (data.code !== 200) {\n  Toast.fail(data.msg)\n  return true;\n }\n}\nexport default reqeust;"]},"metadata":{},"sourceType":"module"}