{"ast":null,"code":"import _toConsumableArray from\"/Users/yuanfang/code/advisory-h5/node_modules/babel-preset-react-app/node_modules/@babel/runtime/helpers/esm/toConsumableArray\";import _objectSpread from\"/Users/yuanfang/code/advisory-h5/node_modules/babel-preset-react-app/node_modules/@babel/runtime/helpers/esm/objectSpread2\";import _slicedToArray from\"/Users/yuanfang/code/advisory-h5/node_modules/babel-preset-react-app/node_modules/@babel/runtime/helpers/esm/slicedToArray\";import\"antd-mobile/lib/list-view/style/css\";import _ListView from\"antd-mobile/lib/list-view\";import{useState,useEffect}from\"react\";var rData=[];var listDataSource=new _ListView.DataSource({rowHasChanged:function rowHasChanged(row1,row2){return row1!==row2;}});var usePaginationHooks=function usePaginationHooks(props){var _useState=useState({indicator:false,refreshing:true,page:1,size:100,isLastPage:false,dataSource:listDataSource}),_useState2=_slicedToArray(_useState,2),config=_useState2[0],setConfig=_useState2[1];var queryPages=props.queryPages,params=props.params;/**\n  * 下拉刷新\n  */var refreshHandle=function refreshHandle(){setTimeout(function(){queryPages(_objectSpread({page:1,size:config.size,rows:config.size},params)).then(function(res){var last=res.last,content=res.content,number=res.number;rData=content;setConfig(_objectSpread(_objectSpread({},config),{},{refreshing:false,indicator:last?true:false,isLastPage:last,dataSource:config.dataSource.cloneWithRows(rData),page:number+1}));}).catch(function(err){setConfig(_objectSpread(_objectSpread({},config),{},{refreshing:false,isLastPage:false,indicator:false}));});},500);};/**\n * 上拉更多\n */var indicatorHandle=function indicatorHandle(){queryPages(_objectSpread({page:config.page+1,size:config.size,rows:config.size},params)).then(function(res){var last=res.last,content=res.content;rData=[].concat(_toConsumableArray(rData),_toConsumableArray(content));setConfig(_objectSpread(_objectSpread({},config),{},{indicator:false,isLastPage:last,dataSource:config.dataSource.cloneWithRows(rData),page:config.page+1}));}).catch(function(err){setConfig(_objectSpread(_objectSpread({},config),{},{indicator:false,isLastPage:false,page:config.page+1}));});};useEffect(function(){if(!config.refreshing)return;refreshHandle();},[config.refreshing]);useEffect(function(){if(config.isLastPage)return;config.indicator&&indicatorHandle();},[config.indicator]);return{setIndicator:function setIndicator(){return setConfig(_objectSpread(_objectSpread({},config),{},{indicator:true}));},setRefresing:function setRefresing(){return setConfig(_objectSpread(_objectSpread({},config),{},{refreshing:true}));},refreshHandle:refreshHandle,indicatorHandle:indicatorHandle,indicator:config.indicator,refreshing:config.refreshing,isLastPage:config.isLastPage,dataSource:config.dataSource};};export default usePaginationHooks;","map":null,"metadata":{},"sourceType":"module"}