{"ast":null,"code":"import{Fragment as _Fragment}from\"react/jsx-runtime\";import\"antd-mobile/lib/checkbox/style/css\";import _Checkbox from\"antd-mobile/lib/checkbox\";import{jsxs as _jsxs}from\"react/jsx-runtime\";import{jsx as _jsx}from\"react/jsx-runtime\";import\"antd-mobile/lib/toast/style/css\";import _Toast from\"antd-mobile/lib/toast\";import _slicedToArray from\"/Users/yuanfang/code/advisory-h5/node_modules/babel-preset-react-app/node_modules/@babel/runtime/helpers/esm/slicedToArray\";import React,{useEffect,useRef,useState}from\"react\";import{saleList,receive,notReceive}from\"../request\";import{downTime,mm_dd_hh_mm_ss2,mm_ss_zh,timeDisparity}from\"@utils/dataTime\";//@ts-ignore\nimport\"../style.scss\";//@ts-ignore\nimport sound from\"../img/sound.mp3\";import{toFixed}from\"@utils/numberUtils\";import{checkSound}from\"@utils/sound\";var tempData=[];var OnSale=function OnSale(){var _useState=useState(false),_useState2=_slicedToArray(_useState,2),oneAlertState=_useState2[0],setOneAlertState=_useState2[1];var _useState3=useState(false),_useState4=_slicedToArray(_useState3,2),agentAlertState=_useState4[0],setAgentAlertState=_useState4[1];var _useState5=useState(false),_useState6=_slicedToArray(_useState5,2),unMoneyState=_useState6[0],setUnMoneyState=_useState6[1];var _useState7=useState(false),_useState8=_slicedToArray(_useState7,2),radioState=_useState8[0],setRadioState=_useState8[1];var _useState9=useState([]),_useState10=_slicedToArray(_useState9,2),data=_useState10[0],setData=_useState10[1];var _useState11=useState({}),_useState12=_slicedToArray(_useState11,2),current=_useState12[0],setCurrent=_useState12[1];var soundControl=useRef();useEffect(function(){saleListHandle();var id=setInterval(function(){saleListHandle();},3000);return function(){return clearInterval(id);};},[]);var saleListHandle=function saleListHandle(){saleList({}).then(function(res){soundControl.current&&soundControl.current.pause();var newData=[];var oldData=[];res.map(function(item){return newData.push(item.orderId);});tempData.map(function(item){return oldData.push(item.orderId);});var isHas=newData.filter(function(v){return oldData.indexOf(v)==-1;});if(isHas.length>0){try{checkSound()&&soundControl.current.play();}catch(error){}}setData(res);tempData=res;});// saleList().then((res: any) => {\n//   Toast.hide()\n//   setData(res)\n// })\n};var receiveHandle=function receiveHandle(){_Toast.loading(\"提交中...\");receive({saleItemId:current.saleItemId}).then(function(data){setOneAlertState(false);setAgentAlertState(false);saleListHandle();_Toast.success(\"提交成功!\");});};var notReceiveHandle=function notReceiveHandle(){if(!radioState)return;_Toast.loading(\"提交中...\");notReceive({saleItemId:current.saleItemId}).then(function(data){setUnMoneyState(false);setRadioState(false);saleListHandle();_Toast.success(\"提交成功!\");});};var oneAlert=function oneAlert(){return/*#__PURE__*/_jsx(\"div\",{className:\"alert-container\",children:/*#__PURE__*/_jsxs(\"div\",{className:\"on-sale-alert\",children:[/*#__PURE__*/_jsx(\"p\",{className:\"alert-top\",children:\"\\u6536\\u6B3E\\u786E\\u8BA4\"}),/*#__PURE__*/_jsxs(\"p\",{className:\"alert-min\",children:[/*#__PURE__*/_jsxs(\"span\",{children:[\"\\u8BF7\\u67E5\\u770B\",/*#__PURE__*/_jsx(\"i\",{children:\"\\u3010\\u94F6\\u884C\\u5361\\u3011\"}),\"\\xA5\",toFixed(current.payAmount),\"\\u662F\\u5426\\u5230\\u8D26\"]}),/*#__PURE__*/_jsxs(\"div\",{className:\"item\",children:[/*#__PURE__*/_jsxs(\"p\",{className:\"item-bank\",children:[/*#__PURE__*/_jsxs(\"span\",{children:[\"\\u94F6\\u884C\\u5361\\u53F7:\",current.bankCardNo]}),/*#__PURE__*/_jsxs(\"span\",{children:[\"\\u4ED8\\u6B3E\\u4EBA:\",current.payerName]})]}),/*#__PURE__*/_jsxs(\"p\",{className:\"item-order\",children:[/*#__PURE__*/_jsxs(\"span\",{children:[\"\\u8BA2\\u5355\\u7F16\\u53F7:\",current.orderId]}),/*#__PURE__*/_jsx(\"span\",{children:mm_dd_hh_mm_ss2(current.payTime)})]}),/*#__PURE__*/_jsxs(\"div\",{className:\"item-info\",children:[/*#__PURE__*/_jsx(\"span\",{className:\"order-icon\"}),/*#__PURE__*/_jsxs(\"p\",{className:\"order-i\",children:[/*#__PURE__*/_jsxs(\"span\",{className:\"special\",children:[\"\\xA5\",toFixed(current.payAmount)]}),/*#__PURE__*/_jsxs(\"span\",{children:[\"\\u8D5A:\",/*#__PURE__*/_jsx(\"i\",{className:\"info-icon\"}),\"\\xA5\",toFixed(current.bonus)]})]})]})]})]}),/*#__PURE__*/_jsxs(\"p\",{className:\"alert-bottom\",children:[/*#__PURE__*/_jsx(\"span\",{onClick:function onClick(){return setOneAlertState(false);},children:\"\\u53D6\\u6D88\"}),/*#__PURE__*/_jsx(\"span\",{onClick:function onClick(){return setAgentAlertState(true);},children:\"\\u5DF2\\u6536\\u5230\\u6B3E\"})]})]})});};var agentAlert=function agentAlert(){return/*#__PURE__*/_jsx(\"div\",{className:\"alert-container\",children:/*#__PURE__*/_jsxs(\"div\",{className:\"on-sale-alert\",children:[/*#__PURE__*/_jsx(\"p\",{className:\"alert-top red-bg\",children:\"\\u6536\\u6B3E\\u786E\\u8BA4\"}),/*#__PURE__*/_jsxs(\"p\",{className:\"alert-min\",children:[/*#__PURE__*/_jsxs(\"span\",{children:[\"\\u8BF7\\u518D\\u4E09\\u786E\\u8BA4,\\u94F6\\u884C\\u5361\\xA5\",toFixed(current.payAmount),\"\\u662F\\u5426\\u5230\\u8D26\"]}),/*#__PURE__*/_jsxs(\"div\",{className:\"item\",children:[/*#__PURE__*/_jsx(\"p\",{className:\"item-bank red-font\",children:\"\\u82E5\\u672A\\u6536\\u5230\\u6B3E\\uFF0C\\u70B9\\u51FB\\u786E\\u8BA4\\u6536\\u6B3E,\\u9020\\u6210\\u8D44\\u91D1\\u635F\\u5931\\u81EA\\u884C\\u627F\\u62C5\"}),/*#__PURE__*/_jsx(\"p\",{className:\"item-order text-min\",children:\"\\u5982\\u6709\\u4E0D\\u786E\\u5B9A\\u7684\\u8BA2\\u5355\\u8BF7\\u8054\\u7CFB\\u5BA2\\u670D\\u5904\\u7406\"})]})]}),/*#__PURE__*/_jsxs(\"p\",{className:\"alert-bottom\",children:[/*#__PURE__*/_jsx(\"span\",{onClick:function onClick(){setOneAlertState(false);setAgentAlertState(false);},children:\"\\u53D6\\u6D88\"}),/*#__PURE__*/_jsx(\"span\",{onClick:receiveHandle,children:\"\\u518D\\u6B21\\u786E\\u8BA4\"})]})]})});};var unMoneyAlert=function unMoneyAlert(){return/*#__PURE__*/_jsx(\"div\",{className:\"alert-container\",children:/*#__PURE__*/_jsxs(\"div\",{className:\"on-sale-alert\",children:[/*#__PURE__*/_jsx(\"p\",{className:\"alert-top\",children:\"\\u672A\\u6536\\u5230\\u6B3E\"}),/*#__PURE__*/_jsxs(\"p\",{className:\"alert-min\",children:[/*#__PURE__*/_jsx(\"span\",{className:\"yellow-font\",children:\"\\u82E5\\u5DF2\\u6536\\u5230\\u6B3E\\u9879\\u5374\\u70B9\\u51FB\\u3010\\u672A\\u6536\\u5230\\u6B3E\\u3011,\\u6838\\u5B9E\\u540E\\u53EF\\u80FD\\u4F1A\\u5931\\u53BB\\u4EE3\\u552E\\u7684\\u673A\\u4F1A\"}),/*#__PURE__*/_jsx(\"div\",{className:\"item\",children:/*#__PURE__*/_jsxs(\"p\",{className:\"item-bank  just-start\",children:[/*#__PURE__*/_jsx(_Checkbox,{onChange:function onChange(e){setRadioState(!radioState);}}),\" \\u6211\\u5DF2\\u8BA4\\u771F\\u9605\\u8BFB\\u4EE5\\u4E0A\\u63D0\\u793A,\\u786E\\u5B9A\\u6CA1\\u6709\\u6536\\u5230\\u6B3E\"]})})]}),/*#__PURE__*/_jsxs(\"p\",{className:\"alert-bottom\",children:[/*#__PURE__*/_jsx(\"span\",{className:radioState?\"\":\"un-money\",onClick:notReceiveHandle,children:\"\\u672A\\u6536\\u5230\\u6B3E\"}),/*#__PURE__*/_jsx(\"span\",{className:radioState?\"\":\"un-money\",onClick:function onClick(){setUnMoneyState(false);setRadioState(false);},children:\"\\u53D6\\u6D88\"})]})]})});};var unSubmit=function unSubmit(item){return timeDisparity(item.endTime)?/*#__PURE__*/_jsx(\"span\",{className:\"on-money\",onClick:function onClick(){setCurrent(item);setUnMoneyState(true);},children:\"\\u672A\\u6536\\u5230\\u6B3E\"}):/*#__PURE__*/_jsx(\"span\",{className:\"off-money\",children:\"\\u672A\\u6536\\u5230\\u6B3E\"});};var toSubmit=function toSubmit(item){return/*#__PURE__*/_jsx(\"span\",{className:\"on-money\",onClick:function onClick(){setCurrent(item);setOneAlertState(true);},children:\"\\u5DF2\\u6536\\u5230\\u6B3E\"});};var alertUnSubmit=function alertUnSubmit(msg){return/*#__PURE__*/_jsx(\"span\",{className:\"off-money\",onClick:function onClick(){return _Toast.info(msg);},children:\"\\u672A\\u6536\\u5230\\u6B3E\"});};var alertToSubmit=function alertToSubmit(msg){return/*#__PURE__*/_jsx(\"span\",{className:\"off-money\",onClick:function onClick(){return _Toast.info(msg);},children:\"\\u5DF2\\u6536\\u5230\\u6B3E\"});};return/*#__PURE__*/_jsxs(_Fragment,{children:[/*#__PURE__*/_jsx(\"audio\",{src:sound,ref:soundControl,preload:\"\"}),oneAlertState&&oneAlert(),agentAlertState&&agentAlert(),unMoneyState&&unMoneyAlert(),/*#__PURE__*/_jsx(\"ul\",{className:\"consignments\",children:data&&data.map(function(item){return/*#__PURE__*/_jsxs(\"li\",{className:\"item\",children:[/*#__PURE__*/_jsxs(\"p\",{className:\"item-bank\",children:[/*#__PURE__*/_jsxs(\"span\",{children:[\"\\u94F6\\u884C\\u5361\\u53F7:\",item.bankCardNo]}),/*#__PURE__*/_jsxs(\"span\",{style:{textAlign:'right'},children:[\"\\u4ED8\\u6B3E\\u4EBA:\",item.payerName]})]}),/*#__PURE__*/_jsxs(\"p\",{className:\"item-order\",children:[/*#__PURE__*/_jsxs(\"span\",{children:[\"\\u8BA2\\u5355\\u7F16\\u53F7:\",item.orderId]}),/*#__PURE__*/_jsx(\"span\",{style:{textAlign:'right'},children:mm_dd_hh_mm_ss2(item.payTime)})]}),/*#__PURE__*/_jsxs(\"p\",{className:\"item-order\",children:[/*#__PURE__*/_jsxs(\"span\",{children:[\"\\u8BA2\\u5355\\u72B6\\u6001:\",/*#__PURE__*/_jsxs(\"span\",{style:{color:'red'},children:[item.orderStatus==='SUCCESS'&&!item.copyNewOrder?'成功':null,item.orderStatus==='SUCCESS'&&item.copyNewOrder?'复制补单成功':null,item.orderStatus==='CHASE_SUCCESS'?'已追回':null,item.orderStatus==='NOT_RECEIVE_MONEY'?'失败':null,item.orderStatus==='WAIT_USER_ACK'&&item.resetOrder?'重置确认 ':null,item.orderStatus==='WAIT_USER_ACK'&&item.dropOrder&&!item.copyNewOrder&&!item.resetOrder?'掉单.待确认 ':null,item.orderStatus==='WAIT_USER_ACK'&&item.copyNewOrder&&!item.dropOrder?'复制补单.待确认 ':null,item.orderStatus==='WAIT_USER_ACK'&&item.copyNewOrder&&item.dropOrder?'复制补单：掉单.待确认 ':null,item.orderStatus==='WAIT_USER_ACK'&&!item.resetOrder&&!item.dropOrder&&!item.copyNewOrder?'等待会员确认':null,item.orderStatus==='SUBMIT_TIMEOUT'&&!item.resetOrder&&!item.dropOrder&&!item.copyNewOrder?'确认超时':null,item.orderStatus==='SUBMIT_TIMEOUT'&&item.resetOrder?'重置确认 ':null,item.orderStatus==='SUBMIT_TIMEOUT'&&item.dropOrder&&!item.copyNewOrder&&!item.resetOrder?'掉单.待确认 ':null,item.orderStatus==='SUBMIT_TIMEOUT'&&item.copyNewOrder&&!item.dropOrder?'复制补单.待确认 ':null,item.orderStatus==='SUBMIT_TIMEOUT'&&item.copyNewOrder&&item.dropOrder?'复制补单：掉单.待确认 ':null,item.orderStatus==='WAIT_PLATFORM_CHECK_FOR_NOT_RECEIVE'?'待审核未到款':null]})]}),item.copyNewOrder||item.dropOrder||item.resetOrder?null:/*#__PURE__*/_jsxs(\"span\",{children:[\"\\u5012\\u8BA1\\u65F6:\",/*#__PURE__*/_jsx(\"span\",{style:{color:'red'},children:mm_ss_zh(downTime(item.endTime))})]})]}),/*#__PURE__*/_jsxs(\"div\",{className:\"item-info\",children:[/*#__PURE__*/_jsx(\"span\",{className:\"order-icon\"}),/*#__PURE__*/_jsxs(\"p\",{className:\"order-i\",children:[/*#__PURE__*/_jsxs(\"span\",{className:\"special\",children:[\"\\xA5\",toFixed(item.payAmount)]}),/*#__PURE__*/_jsxs(\"span\",{children:[\"\\u8D5A:\",/*#__PURE__*/_jsx(\"i\",{className:\"info-icon\"}),\"\\xA5\",toFixed(item.bonus)]})]}),// 待确认\nitem.orderStatus==='WAIT_USER_ACK'&&!item.copyNewOrder&&!item.resetOrder&&!item.copyOrder&&!item.dropOrder&&/*#__PURE__*/_jsxs(_Fragment,{children:[unSubmit(item),toSubmit(item)]}),// 重置确认\nitem.orderStatus==='WAIT_USER_ACK'&&item.resetOrder&&/*#__PURE__*/_jsxs(_Fragment,{children:[alertUnSubmit('请确认收款'),toSubmit(item)]}),// 复制补单 掉单重置 \nitem.orderStatus==='WAIT_USER_ACK'&&(item.copyNewOrder||item.dropOrder)&&!item.resetOrder&&/*#__PURE__*/_jsxs(_Fragment,{children:[alertUnSubmit('请确认收款'),toSubmit(item)]}),// 领取超时\nitem.orderStatus==='SUBMIT_TIMEOUT'&&!item.copyNewOrder&&!item.resetOrder&&!item.copyOrder&&!item.dropOrder&&/*#__PURE__*/_jsxs(_Fragment,{children:[unSubmit(item),toSubmit(item)]}),// 领取超时-复制补单等等\nitem.orderStatus==='SUBMIT_TIMEOUT'&&(item.copyNewOrder||item.copyOrder||item.dropOrder||item.resetOrder)&&/*#__PURE__*/_jsxs(_Fragment,{children:[alertUnSubmit('请确认收款'),toSubmit(item)]}),!['SUBMIT_TIMEOUT','WAIT_USER_ACK'].includes(item.orderStatus)&&/*#__PURE__*/_jsxs(_Fragment,{children:[alertUnSubmit(item==='LOCKED'?'不能提交,请联系客服':'等待审核'),alertToSubmit(item==='LOCKED'?'不能提交,请联系客服':'等待审核')]})]})]},item.orderId);})})]});};export default OnSale;","map":null,"metadata":{},"sourceType":"module"}