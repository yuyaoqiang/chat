{"ast":null,"code":"/**\r\n * Extracts Fujifilm flavored Makernotes which are always stored in little\r\n * endian, no matter what the rest of the file is. Additionally the offsets\r\n * are relative to the start of the Makernote instead of the start of the\r\n * TIFF header.\r\n */\nexports.extractMakernotes = function (data, makernoteOffset, tiffOffset) {\n  // List of vendor specific Makernote tags found on\n  // http://www.sno.phy.queensu.ca/~phil/exiftool/TagNames/FujiFilm.html\n  var tags = {\n    0x0000: \"Version\",\n    0x0010: \"InternalSerialNumber\",\n    0x1000: \"Quality\",\n    0x1001: \"Sharpness\",\n    0x1002: \"WhiteBalance\",\n    0x1003: \"Saturation\",\n    0x1004: \"Contrast\",\n    0x1005: \"ColorTemperature\",\n    0x1006: \"Contrast\",\n    0x100a: \"WhiteBalanceFineTune\",\n    0x100b: \"NoiseReduction\",\n    0x100e: \"HighISONoiseReduction\",\n    0x1010: \"FujiFlashMode\",\n    0x1011: \"FlashExposureComp\",\n    0x1020: \"Macro\",\n    0x1021: \"FocusMode\",\n    0x1023: \"FocusPixel\",\n    0x1030: \"SlowSync\",\n    0x1033: \"EXRAuto\",\n    0x1034: \"EXRMode\",\n    0x1100: \"AutoBracketing\",\n    0x1101: \"SequenceNumber\",\n    0x1210: \"ColorMode\",\n    0x1300: \"BlurWarning\",\n    0x1301: \"FocusWarning\",\n    0x1302: \"ExposureWarning\",\n    0x1304: \"GEImageSize\",\n    0x1400: \"DynamicRange\",\n    0x1401: \"FilmMode\",\n    0x1402: \"DynamicRangeSetting\",\n    0x1403: \"DevelopmentDynamicRange\",\n    0x1404: \"MinFocalLength\",\n    0x1405: \"MaxFocalLength\",\n    0x1406: \"MaxApertureAtMinFocal\",\n    0x1407: \"MaxApertureAtMaxFocal\",\n    0x140b: \"AutoDynamicRange\",\n    0x4100: \"FacesDetected\",\n    0x4103: \"FacePositions\",\n    0x4282: \"FaceRecInfo\",\n    0x8000: \"FileSource\",\n    0x8002: \"OrderNumber\",\n    0x8003: \"FrameNumber\",\n    0xb211: \"Parallax\"\n  }; // Start of the Fujifilm flavored Makernote data is determined by the four\n  // bytes following the Makernote vendor name\n\n  var ifdOffset = makernoteOffset + data.getLong(makernoteOffset + 8, false, tiffOffset); // Get the number of entries and extract them\n\n  var numberOfEntries = data.getShort(ifdOffset, false);\n\n  if (this.options.fujifilmMaxEntries) {\n    numberOfEntries = Math.min(numberOfEntries, this.options.fujifilmMaxEntries);\n  }\n\n  var makernoteData = {};\n\n  for (var i = 0; i < numberOfEntries; i++) {\n    var exifEntry = this.extractExifEntry(data, ifdOffset + 2 + i * 12, makernoteOffset, false, tags);\n    if (exifEntry && exifEntry.tagName !== null) makernoteData[exifEntry.tagName] = exifEntry.value;\n  }\n\n  return makernoteData;\n};","map":null,"metadata":{},"sourceType":"script"}