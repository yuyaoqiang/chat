{"ast":null,"code":"import{jsxs as _jsxs}from\"react/jsx-runtime\";import\"antd-mobile/lib/pull-to-refresh/style/css\";import _PullToRefresh from\"antd-mobile/lib/pull-to-refresh\";import\"antd-mobile/lib/toast/style/css\";import _Toast from\"antd-mobile/lib/toast\";import _objectDestructuringEmpty from\"/Users/yuanfang/Downloads/Telegram Desktop/\\u5C01\\u5B58/advisory-h5/node_modules/babel-preset-react-app/node_modules/@babel/runtime/helpers/esm/objectDestructuringEmpty\";import{jsx as _jsx}from\"react/jsx-runtime\";import _regeneratorRuntime from\"/Users/yuanfang/Downloads/Telegram Desktop/\\u5C01\\u5B58/advisory-h5/node_modules/babel-preset-react-app/node_modules/@babel/runtime/regenerator\";import _toConsumableArray from\"/Users/yuanfang/Downloads/Telegram Desktop/\\u5C01\\u5B58/advisory-h5/node_modules/babel-preset-react-app/node_modules/@babel/runtime/helpers/esm/toConsumableArray\";import _asyncToGenerator from\"/Users/yuanfang/Downloads/Telegram Desktop/\\u5C01\\u5B58/advisory-h5/node_modules/babel-preset-react-app/node_modules/@babel/runtime/helpers/esm/asyncToGenerator\";import _slicedToArray from\"/Users/yuanfang/Downloads/Telegram Desktop/\\u5C01\\u5B58/advisory-h5/node_modules/babel-preset-react-app/node_modules/@babel/runtime/helpers/esm/slicedToArray\";import\"antd-mobile/lib/list-view/style/css\";import _ListView from\"antd-mobile/lib/list-view\";import React,{useEffect,useRef}from\"react\";import Header from\"./component/header\";import Tabs from\"./component/tabs\";import Match from\"./component/match\";import Publish from\"./component/publish\";import ReactDOM from\"react-dom\";import{useState}from\"react\";import{query,queryByType}from\"./request\";import'./style.scss';import{useHistory}from\"react-router-dom\";var listDataSource=new _ListView.DataSource({rowHasChanged:function rowHasChanged(row1,row2){return row1!==row2;}});var rData=[];var Pusher=function Pusher(){var ref=useRef(null);var childRef=/*#__PURE__*/React.createRef();var _useState=useState(5),_useState2=_slicedToArray(_useState,2),containerHeieght=_useState2[0],setContainerHeight=_useState2[1];var _useState3=useState(false),_useState4=_slicedToArray(_useState3,2),isLoading=_useState4[0],setIsLoading=_useState4[1];var _useState5=useState(false),_useState6=_slicedToArray(_useState5,2),refreshing=_useState6[0],setRefreshing=_useState6[1];var _useState7=useState(1),_useState8=_slicedToArray(_useState7,2),pageNo=_useState8[0],setPageNo=_useState8[1];var _useState9=useState(20),_useState10=_slicedToArray(_useState9,1),pageSize=_useState10[0];var _useState11=useState(false),_useState12=_slicedToArray(_useState11,2),isLastPage=_useState12[0],setIsLastPage=_useState12[1];var _useState13=useState(listDataSource),_useState14=_slicedToArray(_useState13,2),dataSource=_useState14[0],setDataSource=_useState14[1];var _useState15=useState(undefined),_useState16=_slicedToArray(_useState15,2),check=_useState16[0],setCheck=_useState16[1];var _useState17=useState([]),_useState18=_slicedToArray(_useState17,2),tabData=_useState18[0],setTabData=_useState18[1];var _useState19=useState([]),_useState20=_slicedToArray(_useState19,2),datas=_useState20[0],setDatas=_useState20[1];var _useState21=useState(0),_useState22=_slicedToArray(_useState21,2),total=_useState22[0],setTotal=_useState22[1];var history=useHistory();var getRealHeight=function getRealHeight(){var htmlFont=Number(document.documentElement.style.fontSize.slice(0,2));var clientHeight=document.documentElement.clientHeight;//@ts-ignore\nvar top=ReactDOM.findDOMNode(ref.current).offsetTop;//@ts-ignore\nvar bottom=ReactDOM.findDOMNode(childRef.current).clientHeight;setContainerHeight((clientHeight-bottom-top)/htmlFont);onRefresh();};var onRefresh=function onRefresh(){setRefreshing(true);setIsLoading(true);queryByType({pageNo:1,pageSize:pageSize,data:{matchNameId:check}}).then(function(res){var _res$data=res.data,list=_res$data.list,isLastPage=_res$data.isLastPage;rData=list;setRefreshing(false);setIsLoading(false);setIsLastPage(isLastPage);setDataSource(dataSource.cloneWithRows(rData));setPageNo(2);});};var onEndReached=/*#__PURE__*/function(){var _ref=_asyncToGenerator(/*#__PURE__*/_regeneratorRuntime.mark(function _callee(){return _regeneratorRuntime.wrap(function _callee$(_context){while(1){switch(_context.prev=_context.next){case 0:if(!(isLastPage||isLoading)){_context.next=2;break;}return _context.abrupt(\"return\");case 2:setIsLoading(true);queryByType({pageNo:pageNo,pageSize:pageSize,data:{matchType:check}}).then(function(res){var data=res.data.data;rData=[].concat(_toConsumableArray(rData),_toConsumableArray(data.list));setIsLastPage(data.isLastPage);setDataSource(dataSource.cloneWithRows(rData));setIsLoading(false);setPageNo(pageNo+1);});case 4:case\"end\":return _context.stop();}}},_callee);}));return function onEndReached(){return _ref.apply(this,arguments);};}();var row=function row(rowData,sectionID,rowID){return/*#__PURE__*/_jsx(Match,{data:rowData,changeCheck:updateDataSource},rowID);};// 获取tabs\nvar getTabs=function getTabs(){query({}).then(function(res){var data=res.data;if(data.length===0)return;var tab=data[0];setCheck(tab.id);setTabData(data);});};// 根据id获取数据\nvar getDataById=function getDataById(_ref2){_objectDestructuringEmpty(_ref2);queryByType({data:{matchType:check}}).then(function(res){setDatas(res.data);}).catch(function(err){setDatas([]);});};// 发布\nvar submit=function submit(){var pushData=[];rData.forEach(function(item){var id=item.id,firstRecommend=item.firstRecommend,secondRecommend=item.secondRecommend,sizeBallRecommend=item.sizeBallRecommend,secondSizeBallRecommend=item.secondSizeBallRecommend;if(firstRecommend||sizeBallRecommend){pushData.push({matchId:id,firstRecommend:firstRecommend,secondRecommend:secondRecommend,sizeBallRecommend:sizeBallRecommend,secondSizeBallRecommend:secondSizeBallRecommend});}});if(pushData.length===0){_Toast.success(\"请选择发布赛事\");return;}};//数据转换\nvar updateDataSource=function updateDataSource(item){var latest=[];var total=0;rData.forEach(function(data){if(data.id===item.id){latest.push(item);}else{latest.push(data);}});latest.map(function(item){if(item.firstRecommend||item.secondRecommend||item.sizeBallRecommend){total=total+1;}});rData=latest;setTotal(total);setDataSource(dataSource.cloneWithRows(latest));};useEffect(function(){getTabs();},[]);useEffect(function(){if(!check)return;setTotal(0);getRealHeight();},[check]);return/*#__PURE__*/_jsxs(\"div\",{className:\"pusher\",children:[/*#__PURE__*/_jsx(Header,{}),/*#__PURE__*/_jsx(Tabs,{check:check,change:setCheck,datas:tabData,total:total}),/*#__PURE__*/_jsx(_ListView,{className:\"push-container\",ref:ref,style:{height:\"\".concat(containerHeieght,\"rem\")},dataSource:dataSource,renderFooter:function renderFooter(){return/*#__PURE__*/_jsx(\"div\",{style:{textAlign:'center'},children:isLoading?'正在加载中.....':'没有更多数据'});},renderRow:row,useBodyScroll:false//@ts-ignore\n,pullToRefresh:/*#__PURE__*/_jsx(_PullToRefresh,{refreshing:refreshing,onRefresh:onRefresh}),onEndReached:onEndReached,pageSize:20}),/*#__PURE__*/_jsx(Publish,{submit:submit,ref:childRef})]});};export default Pusher;","map":null,"metadata":{},"sourceType":"module"}