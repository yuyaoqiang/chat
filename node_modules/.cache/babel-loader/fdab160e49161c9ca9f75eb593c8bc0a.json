{"ast":null,"code":"import \"antd-mobile/lib/pull-to-refresh/style/css\";\nimport _PullToRefresh from \"antd-mobile/lib/pull-to-refresh\";\nimport \"antd-mobile/lib/toast/style/css\";\nimport _Toast from \"antd-mobile/lib/toast\";\nimport { jsxDEV as _jsxDEV } from \"react/jsx-dev-runtime\";\nimport \"antd-mobile/lib/list-view/style/css\";\nimport _ListView from \"antd-mobile/lib/list-view\";\n\nvar _jsxFileName = \"/Users/yuanfang/Downloads/Telegram Desktop/\\u5C01\\u5B58/advisory-h5/src/pages/pusher/index.tsx\",\n    _s = $RefreshSig$();\n\nimport React, { useEffect, useRef } from \"react\";\nimport Header from \"./component/header\";\nimport Tabs from \"./component/tabs\";\nimport Match from \"./component/match\";\nimport Publish from \"./component/publish\";\nimport ReactDOM from \"react-dom\";\nimport { useState } from \"react\";\nimport { query, queryByType } from \"./request\";\nimport './style.scss';\nimport { useHistory } from \"react-router-dom\";\nconst listDataSource = new _ListView.DataSource({\n  rowHasChanged: (row1, row2) => row1 !== row2\n});\nlet rData = [];\n\nconst Pusher = () => {\n  _s();\n\n  const ref = useRef(null);\n  const childRef = /*#__PURE__*/React.createRef();\n  const [containerHeieght, setContainerHeight] = useState(5);\n  const [isLoading, setIsLoading] = useState(false);\n  const [refreshing, setRefreshing] = useState(false);\n  const [pageNo, setPageNo] = useState(1);\n  const [pageSize] = useState(20);\n  const [isLastPage, setIsLastPage] = useState(false);\n  const [dataSource, setDataSource] = useState(listDataSource);\n  const [check, setCheck] = useState(undefined);\n  const [tabData, setTabData] = useState([]);\n  const [datas, setDatas] = useState([]);\n  const [total, setTotal] = useState(0);\n  const history = useHistory();\n\n  const getRealHeight = () => {\n    const htmlFont = Number(document.documentElement.style.fontSize.slice(0, 2));\n    const clientHeight = document.documentElement.clientHeight; //@ts-ignore\n\n    const top = ReactDOM.findDOMNode(ref.current).offsetTop; //@ts-ignore\n\n    const bottom = ReactDOM.findDOMNode(childRef.current).clientHeight;\n    setContainerHeight((clientHeight - bottom - top) / htmlFont);\n    onRefresh();\n  };\n\n  const onRefresh = () => {\n    setRefreshing(true);\n    setIsLoading(true);\n    queryByType({\n      pageNo: 1,\n      pageSize,\n      data: {\n        matchNameId: check\n      }\n    }).then(res => {\n      const {\n        list,\n        isLastPage\n      } = res.data;\n      rData = list;\n      setRefreshing(false);\n      setIsLoading(false);\n      setIsLastPage(isLastPage);\n      setDataSource(dataSource.cloneWithRows(rData));\n      setPageNo(2);\n    });\n  };\n\n  const onEndReached = async () => {\n    if (isLastPage || isLoading) return;\n    setIsLoading(true);\n    queryByType({\n      pageNo,\n      pageSize,\n      data: {\n        matchType: check\n      }\n    }).then(res => {\n      const {\n        data\n      } = res.data;\n      rData = [...rData, ...data.list];\n      setIsLastPage(data.isLastPage);\n      setDataSource(dataSource.cloneWithRows(rData));\n      setIsLoading(false);\n      setPageNo(pageNo + 1);\n    });\n  };\n\n  const row = (rowData, sectionID, rowID) => {\n    return /*#__PURE__*/_jsxDEV(Match, {\n      data: rowData,\n      changeCheck: updateDataSource\n    }, rowID, false, {\n      fileName: _jsxFileName,\n      lineNumber: 73,\n      columnNumber: 4\n    }, this);\n  }; // 获取tabs\n\n\n  const getTabs = () => {\n    query({}).then(res => {\n      const data = res.data;\n      if (data.length === 0) return;\n      const tab = data[0];\n      setCheck(tab.id);\n      setTabData(data);\n    });\n  }; // 根据id获取数据\n\n\n  const getDataById = ({}) => {\n    queryByType({\n      data: {\n        matchType: check\n      }\n    }).then(res => {\n      setDatas(res.data);\n    }).catch(err => {\n      setDatas([]);\n    });\n  }; // 发布\n\n\n  const submit = () => {\n    const pushData = [];\n    rData.forEach(item => {\n      const {\n        id,\n        firstRecommend,\n        secondRecommend,\n        sizeBallRecommend,\n        secondSizeBallRecommend\n      } = item;\n\n      if (firstRecommend || sizeBallRecommend) {\n        pushData.push({\n          matchId: id,\n          firstRecommend,\n          secondRecommend,\n          sizeBallRecommend,\n          secondSizeBallRecommend\n        });\n      }\n    });\n\n    if (pushData.length === 0) {\n      _Toast.success(\"请选择发布赛事\");\n\n      return;\n    }\n  }; //数据转换\n\n\n  const updateDataSource = item => {\n    const latest = [];\n    let total = 0;\n    rData.forEach(data => {\n      if (data.id === item.id) {\n        latest.push(item);\n      } else {\n        latest.push(data);\n      }\n    });\n    latest.map(item => {\n      if (item.firstRecommend || item.secondRecommend || item.sizeBallRecommend) {\n        total = total + 1;\n      }\n    });\n    rData = latest;\n    setTotal(total);\n    setDataSource(dataSource.cloneWithRows(latest));\n  };\n\n  useEffect(() => {\n    getTabs();\n  }, []);\n  useEffect(() => {\n    if (!check) return;\n    setTotal(0);\n    getRealHeight();\n  }, [check]);\n  return /*#__PURE__*/_jsxDEV(\"div\", {\n    className: \"pusher\",\n    children: [/*#__PURE__*/_jsxDEV(Header, {}, void 0, false, {\n      fileName: _jsxFileName,\n      lineNumber: 146,\n      columnNumber: 4\n    }, this), /*#__PURE__*/_jsxDEV(Tabs, {\n      check: check,\n      change: setCheck,\n      datas: tabData,\n      total: total\n    }, void 0, false, {\n      fileName: _jsxFileName,\n      lineNumber: 147,\n      columnNumber: 4\n    }, this), /*#__PURE__*/_jsxDEV(_ListView, {\n      className: \"push-container\",\n      ref: ref,\n      style: {\n        height: `${containerHeieght}rem`\n      },\n      dataSource: dataSource,\n      renderFooter: () => {\n        return /*#__PURE__*/_jsxDEV(\"div\", {\n          style: {\n            textAlign: 'center'\n          },\n          children: isLoading ? '正在加载中.....' : '没有更多数据'\n        }, void 0, false, {\n          fileName: _jsxFileName,\n          lineNumber: 155,\n          columnNumber: 14\n        }, this);\n      },\n      renderRow: row,\n      useBodyScroll: false //@ts-ignore\n      ,\n      pullToRefresh: /*#__PURE__*/_jsxDEV(_PullToRefresh, {\n        refreshing: refreshing,\n        onRefresh: onRefresh\n      }, void 0, false, {\n        fileName: _jsxFileName,\n        lineNumber: 163,\n        columnNumber: 20\n      }, this),\n      onEndReached: onEndReached,\n      pageSize: 20\n    }, void 0, false, {\n      fileName: _jsxFileName,\n      lineNumber: 148,\n      columnNumber: 4\n    }, this), /*#__PURE__*/_jsxDEV(Publish, {\n      submit: submit,\n      ref: childRef\n    }, void 0, false, {\n      fileName: _jsxFileName,\n      lineNumber: 170,\n      columnNumber: 4\n    }, this)]\n  }, void 0, true, {\n    fileName: _jsxFileName,\n    lineNumber: 145,\n    columnNumber: 3\n  }, this);\n};\n\n_s(Pusher, \"vwbTD0t6D7f+Dtb1J54wmJVpyPs=\", false, function () {\n  return [useHistory];\n});\n\n_c = Pusher;\nexport default Pusher;\n\nvar _c;\n\n$RefreshReg$(_c, \"Pusher\");","map":{"version":3,"sources":["/Users/yuanfang/Downloads/Telegram Desktop/封存/advisory-h5/src/pages/pusher/index.tsx"],"names":["React","useEffect","useRef","Header","Tabs","Match","Publish","ReactDOM","useState","query","queryByType","useHistory","listDataSource","DataSource","rowHasChanged","row1","row2","rData","Pusher","ref","childRef","createRef","containerHeieght","setContainerHeight","isLoading","setIsLoading","refreshing","setRefreshing","pageNo","setPageNo","pageSize","isLastPage","setIsLastPage","dataSource","setDataSource","check","setCheck","undefined","tabData","setTabData","datas","setDatas","total","setTotal","history","getRealHeight","htmlFont","Number","document","documentElement","style","fontSize","slice","clientHeight","top","findDOMNode","current","offsetTop","bottom","onRefresh","data","matchNameId","then","res","list","cloneWithRows","onEndReached","matchType","row","rowData","sectionID","rowID","updateDataSource","getTabs","length","tab","id","getDataById","catch","err","submit","pushData","forEach","item","firstRecommend","secondRecommend","sizeBallRecommend","secondSizeBallRecommend","push","matchId","success","latest","map","height","textAlign"],"mappings":"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","sourcesContent":["import React, { useEffect, useRef } from \"react\"\nimport Header from \"./component/header\"\nimport Tabs from \"./component/tabs\"\nimport Match from \"./component/match\"\nimport Publish from \"./component/publish\"\nimport ReactDOM from \"react-dom\"\nimport { useState } from \"react\"\nimport { ListView, PullToRefresh } from \"antd-mobile\";\nimport { query, queryByType } from \"./request\"\nimport './style.scss'\nimport { Toast } from \"antd-mobile\"\nimport { useHistory } from \"react-router-dom\"\nconst listDataSource = new ListView.DataSource({\n rowHasChanged: (row1: any, row2: any) => row1 !== row2,\n});\nlet rData: any[] = []\nconst Pusher = () => {\n const ref: any = useRef(null);\n const childRef = React.createRef();\n const [containerHeieght, setContainerHeight] = useState(5)\n const [isLoading, setIsLoading] = useState(false);\n const [refreshing, setRefreshing] = useState(false);\n const [pageNo, setPageNo] = useState(1);\n const [pageSize] = useState(20);\n const [isLastPage, setIsLastPage] = useState(false);\n const [dataSource, setDataSource] = useState(listDataSource);\n const [check, setCheck] = useState<number | undefined>(undefined)\n const [tabData, setTabData] = useState<MatchType[]>([]);\n const [datas, setDatas] = useState<MatchData[]>([])\n const [total, setTotal] = useState(0)\n const history = useHistory();\n\n const getRealHeight = () => {\n  const htmlFont: number = Number(document.documentElement.style.fontSize.slice(0, 2));\n  const clientHeight: number = document.documentElement.clientHeight;\n  //@ts-ignore\n  const top = ReactDOM.findDOMNode(ref.current).offsetTop\n  //@ts-ignore\n  const bottom = ReactDOM.findDOMNode(childRef.current).clientHeight\n  setContainerHeight((clientHeight - bottom - top) / htmlFont);\n  onRefresh();\n }\n\n const onRefresh = () => {\n  setRefreshing(true)\n  setIsLoading(true)\n  queryByType({ pageNo: 1, pageSize, data: { matchNameId: check } }).then(res => {\n   const { list, isLastPage } = res.data;\n   rData = list\n   setRefreshing(false)\n   setIsLoading(false)\n   setIsLastPage(isLastPage)\n   setDataSource(dataSource.cloneWithRows(rData));\n   setPageNo(2)\n  })\n };\n\n const onEndReached = async () => {\n  if (isLastPage || isLoading) return;\n  setIsLoading(true)\n  queryByType({ pageNo, pageSize, data: { matchType: check } }).then(res => {\n   const { data } = res.data;\n   rData = [...rData, ...data.list]\n   setIsLastPage(data.isLastPage)\n   setDataSource(dataSource.cloneWithRows(rData));\n   setIsLoading(false)\n   setPageNo(pageNo + 1)\n  })\n };\n\n const row = (rowData: any, sectionID: any, rowID: any) => {\n  return (\n   <Match key={rowID} data={rowData} changeCheck={updateDataSource} />\n  );\n };\n\n // 获取tabs\n const getTabs = () => {\n  query({}).then(res => {\n   const data: MatchType[] = res.data;\n   if (data.length === 0) return;\n   const tab = data[0];\n   setCheck(tab.id);\n   setTabData(data);\n  })\n }\n\n // 根据id获取数据\n const getDataById = ({ }) => {\n  queryByType({ data: { matchType: check } }).then((res: any) => {\n   setDatas(res.data)\n  }).catch(err => {\n   setDatas([])\n  })\n }\n\n // 发布\n const submit = () => {\n  const pushData: any[] = []\n  rData.forEach((item: MatchData) => {\n   const { id, firstRecommend, secondRecommend, sizeBallRecommend, secondSizeBallRecommend } = item;\n   if (firstRecommend || sizeBallRecommend) {\n    pushData.push({ matchId: id, firstRecommend, secondRecommend, sizeBallRecommend, secondSizeBallRecommend })\n   }\n  })\n  if (pushData.length === 0) {\n   Toast.success(\"请选择发布赛事\");\n   return;\n  }\n }\n\n //数据转换\n const updateDataSource = (item: MatchData) => {\n  const latest = [] as MatchData[]\n  let total = 0;\n  rData.forEach(data => {\n   if (data.id === item.id) {\n    latest.push(item);\n   } else {\n    latest.push(data);\n   }\n  });\n\n  latest.map(item => {\n   if (item.firstRecommend || item.secondRecommend || item.sizeBallRecommend) {\n    total = total + 1\n   }\n  })\n  rData = latest;\n  setTotal(total)\n  setDataSource(dataSource.cloneWithRows(latest));\n }\n\n useEffect(() => {\n  getTabs();\n }, [])\n\n useEffect(() => {\n  if (!check) return;\n  setTotal(0)\n  getRealHeight()\n }, [check])\n\n return (\n  <div className=\"pusher\">\n   <Header />\n   <Tabs check={check} change={setCheck} datas={tabData} total={total} />\n   <ListView\n    className=\"push-container\"\n    ref={ref}\n    style={{ height: `${containerHeieght}rem` }}\n    dataSource={dataSource}\n    renderFooter={\n     () => {\n      return <div style={{ textAlign: 'center' }}>\n       {isLoading ? '正在加载中.....' : '没有更多数据'}\n      </div>\n     }\n    }\n    renderRow={row}\n    useBodyScroll={false}\n    //@ts-ignore\n    pullToRefresh={<PullToRefresh\n     refreshing={refreshing}\n     onRefresh={onRefresh}\n    />}\n    onEndReached={onEndReached}\n    pageSize={20}\n   />\n   <Publish submit={submit} ref={childRef} />\n  </div>\n )\n}\nexport default Pusher;"]},"metadata":{},"sourceType":"module"}